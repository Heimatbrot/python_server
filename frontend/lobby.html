<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heimatbrot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='lobby.css') }}">
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
</head>
<body>
    <h1>Lobby</h1>
    <div class="box">
        <h2>Current Room</h2>
        <h3 id="username">Playing as: NOT AVAILABLE</h3>
        <h3 id="roomID">Room ID: NOT AVAILABLE</h3>
        <h3 id="players">Total Players: NOT AVAILABLE</h3>
        <h3 id="readyPlayers">Ready: NOT AVAILABLE</h3>
        <button onclick=leaveRoom()>Leave Room</button>
        <button id="readyButton" onclick=setReady()>set ready</button>
    </div>

    <script>
        var socket = io();

        var ready = false;
        document.addEventListener('DOMContentLoaded', (event) => {
            var ready = false; // Your variable

            var button = document.getElementById('readyButton');
            if (!ready) {
                button.classList.add('readyButton');
            } else {
                button.classList.remove('readyButton');
            }

            // Optionally, you can add an event listener to toggle the ready state
            button.addEventListener('click', () => {
                ready = !ready;
                if (!ready) {
                    button.classList.add('readyButton');
                } else {
                    button.classList.remove('readyButton');
                }
            });
        });

        window.onload = function() {
            var room = localStorage.getItem('room');
            var username = localStorage.getItem('username');
            document.getElementById('roomID').innerText = 'Room ID: ' + room;
            document.getElementById('username').innerText = 'Playing as: ' + username;
        }

        function leaveRoom() {
            var username = localStorage.getItem('username');
            var room = localStorage.getItem('room');
            if (ready) {
                var room = localStorage.getItem('room');
                socket.emit('removeReady', {room: room});
            }
            socket.emit('leaveRoom', {username: username, room: room});
            localStorage.removeItem('username');
            localStorage.removeItem('room');
            window.location.href = '/';
        }

        function joinRoom() {
            var username = document.getElementById('usernameJoin').value;
            var room = document.getElementById('room').value;
            socket.emit('joinRoom', {room: room, username: username });
        }

        socket.on('roomJoined', function(data) {
            localStorage.setItem('room', data.room);
            localStorage.setItem('username', data.username);
            window.location.href = '/lobby';
        });

        socket.on('players', function(data) {
            document.getElementById('players').innerText = 'Total Players: ' + data.players + ' (MIN 3)';
            document.getElementById('readyPlayers').innerText = 'Ready: ' + data.readyPlayers + ' of ' + data.players;
        });

        socket.on('startGame', function() {
            ready = false;
            window.location.href = '/createMeme';
        });

        function setReady() {
            var room = localStorage.getItem('room');
            if (ready) {
                ready = false
                socket.emit('removeReady', {room: room});
                document.getElementById('readyButton').innerText = 'set ready';
            } else {
                ready = true
                socket.emit('setReady', {room: room});
                document.getElementById('readyButton').innerText = 'remove ready';
            }
        }

    </script>
</body>
</html>